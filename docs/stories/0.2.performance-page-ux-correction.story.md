# Story 0.2: Performance Page UX Correction

## Status
Done

## Story
**As a** user viewing the Perform screen,
**I want** parameters organized by their page sort order without navigation UI,
**so that** the interface accurately reflects how the hardware interprets page values.

## Acceptance Criteria
1. Page Nav removed from Perform screen
2. Colored page number chips removed from UI
3. Page field retained in mapping data (used for sorting only)
4. Perform screen items sorted first by page number, then alphabetically within each page
5. Navigation rail for pages completely removed
6. UI reflects correct mental model: page = sort order, not navigation destination

## Tasks / Subtasks
- [x] Remove Page Nav UI elements (AC: 1, 5)
  - [x] Locate and remove Page Nav widget from Perform screen
  - [x] Remove navigation rail component
  - [x] Clean up related state/handlers for page navigation
- [x] Remove colored page chips (AC: 2)
  - [x] Find page number chip widgets in Perform screen
  - [x] Remove chip rendering code
  - [x] Clean up related styling
- [x] Verify page field in data model (AC: 3)
  - [x] Confirm page field exists in mapping data structure
  - [x] Ensure page value persists (needed for sorting)
  - [x] Verify page can still be set in property editor
- [x] Implement correct sorting logic (AC: 4)
  - [x] Update Perform screen list rendering
  - [x] Sort items: primary by page (ascending), secondary alphabetically within page
  - [x] Test with various page assignments
- [x] Update any documentation/comments (AC: 6)
  - [x] Correct code comments about page purpose
  - [x] Update UI comments to reflect "sort order" concept

## Dev Notes

### Problem Context
Hardware testing revealed "performance page" is not a navigation concept - it's a sort order field. Parameters with higher page numbers appear below those with lower numbers. Current UI incorrectly presents pages as navigation destinations with nav rails and colored chips.

### Corrected Mental Model
- **OLD (incorrect)**: Pages are separate views/tabs to navigate between
- **NEW (correct)**: Page number is a sort/grouping field; higher page = lower in list

### UI Changes Required
**Remove:**
- Page Nav widget
- Navigation rail for pages
- Colored page number chips

**Keep:**
- Page field in mapping (for sorting)
- Page setting in property editor

**Change:**
- Sort algorithm: order by page ASC, then name ASC within page

### Relevant Components
**UI Components:**
- `lib/ui/widgets/performance/perform_screen.dart` (or similar)
- Performance mapping UI widgets
- Page navigation controls

**Data Model:**
- Performance mapping data structure (keep page field)
- Sorting/ordering logic

**State:**
- `lib/cubit/disting_cubit.dart` - May have page nav state to remove

### Testing
**Testing Standards:**
- Test files located in `test/` mirroring source structure
- Use Flutter test framework
- Follow existing test patterns in codebase
- Zero tolerance for `flutter analyze` warnings

**Test Requirements:**
- Verify page nav UI removed
- Verify correct sort order (page then alpha)
- Test with multiple items on same page
- Test with items on different pages
- Ensure page field still editable in property editor

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-30 | 1.0 | Initial bug story creation | Scrum Master |
| 2025-09-30 | 1.1 | Story approved | Scrum Master |

## Dev Agent Record

### Agent Model Used
claude-sonnet-4-5-20250929

### Debug Log References
None

### Completion Notes List
- Removed NavigationRail widget and all page navigation UI elements
- Removed _selectedPageIndex state variable and related page filtering logic
- Implemented _sortParameters method that sorts by page (ascending), then alphabetically by parameter name
- Updated PackedMappingData comment to clarify page field is for sort order only
- Updated all tests to reflect new behavior (no navigation rail, all parameters visible, sorted correctly)
- All tests pass, flutter analyze shows no issues in modified files

### File List
- lib/ui/performance_screen.dart (modified)
- lib/models/packed_mapping_data.dart (modified)
- test/ui/performance_screen_test.dart (modified)

## QA Results

### Review Date: 2025-10-01

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment
- Navigation UI and page chips removed; parameters now sort via `_sortParameters` (page asc, then name) so the list mirrors hardware order (`lib/ui/performance_screen.dart:35`).
- Empty-state copy clarifies the property editor remains the place to assign pages (`lib/ui/performance_screen.dart:65`).
- Data model comment documents that `perfPageIndex` is a sort key only (`lib/models/packed_mapping_data.dart:41`).

### Compliance Check
- Coding Standards: ✓ – Cubit usage untouched; UI changes follow existing widget patterns.
- Project Structure: ✓ – Sorting encapsulated in the screen; data model retained.
- Testing Strategy: ✓ – Widget tests cover empty state, nav removal, sorting order, and filtered input (`test/ui/performance_screen_test.dart:122,127,173,234`).
- All ACs Met: ✓ – Items list without navigation, chips removed, ordering verified, page field preserved for sorting.

### Issues Found
- None.

### Testing Review
- Execution: Not rerun by QA; relying on developer widget tests.
- Coverage: New tests confirm nav removal and ordering; legacy flows still exercised (`test/ui/performance_screen_test.dart:127-232`).
- Gap: Recommend manual spot-check with hardware to ensure alphabetical ordering matches user expectation when names collide.

### Gate Status
- Gate: PASS → `docs/qa/gates/0.2-performance-page-ux-correction.yml`
- Risk profile: not generated.
- NFR assessment: Reliability cleared; others unaffected.

### Recommended Status
- ✓ Ready to Proceed – Story 0.2 meets acceptance criteria and passes QA gate.
